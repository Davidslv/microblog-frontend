# Kamal deployment configuration for frontend
# This deploys the React frontend as a static site served by Nginx
#
# Usage:
# export FRONTEND_HOST=your-frontend-domain.com
# export VITE_API_URL=https://your-backend-domain.com/api/v1
# export DOCKER_USERNAME=your-dockerhub-username
# export DOCKER_PASSWORD=<your-docker-password-or-token>
#   kamal deploy

service: microblog-frontend

image: <%= ENV.fetch("DOCKER_USERNAME", "your-dockerhub-username") %>/microblog-frontend

# Build configuration
builder:
  arch: amd64
  dockerfile: Dockerfile
  context: .
  # Build args for Vite (embedded at build time)
  args:
    VITE_API_URL: <%= ENV.fetch("VITE_API_URL", "https://your-backend-domain.com/api/v1") %>

# Server configuration
servers:
  web:
    hosts:
      - <%= ENV.fetch("FRONTEND_HOST", "your-frontend-domain.com") %>
    # options:
    #   "add-host": host.docker_hostname + ":host-gateway"

# Registry configuration (Docker Hub or private registry)
registry:
  username: <%= ENV.fetch("DOCKER_USERNAME", "your-dockerhub-username") %>
  password:
    - KAMAL_REGISTRY_PASSWORD
  server: <%= ENV.fetch("DOCKER_REGISTRY", "docker.io") %>

# SSL configuration (automatic Let's Encrypt)
# Note: SSL only works with domain names, not IP addresses
proxy:
  ssl: true
  host: <%= ENV.fetch("FRONTEND_HOST", "your-frontend-domain.com") %>

# Health check
# healthcheck:
#   path: /
#   port: 80
#   max_attempts: 10
#   interval: 10s

# Environment variables (for runtime, though Vite vars are build-time)
env:
  clear:
    # Note: VITE_API_URL must be set at build time via builder.args
    # This is here for reference/documentation
    NODE_ENV: production

# Labels
labels:
  service: microblog-frontend

# Resource limits
# limits:
#   memory: 256m
#   cpus: 0.5


